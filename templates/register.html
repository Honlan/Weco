{% extends "layout.html" %} {% block style %}
<style>
#register {
    text-align: center;
    width: 100%;
    padding-top: 40px;
    padding-bottom: 50px;
}

#register h1 {
    margin-top: 0;
}

#register form {
    width: 60%;
    margin: 0 auto;
}

#register form .input-group {
    margin-bottom: 20px;
    width: 100%;
}

#register form button {
    color: #666;
    width: 100%;
}

#register #register_error {
    opacity: 0;
    font-size: 12px;
    color: #F75E5E;
    margin: 0;
    height: 17px;
}
</style>
{% endblock %} {% block body %}
<div id="register">
    <h1>一个<span style="color:blue;">We</span><span style="color:red;">co</span>账号</h1>
    <h2 style="margin-bottom:40px;">领略万千炫酷创意</h2>
    <form class="form-inline" method="post" action="{{ url_for('register') }}">
        <div class="form-group">
            <div class="input-group">
                <div class="input-group-addon"><span class="fa fa-fw fa-user"></span></div>
                <input type="text" class="form-control" name="username" placeholder="用户名">
            </div>
            <div class="input-group">
                <div class="input-group-addon"><span class="fa fa-fw fa-envelope"></span></div>
                <input type="text" class="form-control" name="email" placeholder="邮箱">
            </div>
            <div class="input-group">
                <div class="input-group-addon"><span class="fa fa-fw fa-lock"></span></div>
                <input type="password" class="form-control" name="password" placeholder="密码">
            </div>
            <div class="input-group">
                <div class="input-group-addon"><span class="fa fa-fw fa-repeat"></span></div>
                <input type="password" class="form-control" name="password1" placeholder="确认密码">
            </div>
            <p id="register_error"></p>
        </div>
        <button type="submit" class="btn btn-default disabled">注册</button>
        <div class="input-group" style="margin-top:30px;">
            <p>已有账号？<a href="{{url_for('login')}}">立即登陆</a></p>
        </div>
    </form>
</div>
<script>
$(document).ready(function() {
    var ok1 = false,
        ok2 = false,
        ok3 = false;
    $('#register input[name="username"]').blur(function() {
        var username = $(this).val();
        $.ajax({
            url: '{{url_for("api_user_exist_name")}}',
            type: 'POST',
            data: {
                username: username
            },
            dataType: 'json',
            error: function() {},
            success: function(data) {
                if (data['exist']) {
                    $('#register #register_error').css('opacity', '1').text('用户名已存在');
                    $('#register button[type="submit"]').addClass('disabled');
                } else {
                    ok1 = true;
                }
                if (ok1 && ok2 && ok3) {
                    $('#register #register_error').css('opacity', '0');
                    $('#register button[type="submit"]').removeClass('disabled');
                }
            }
        });
    });

    $('#register input[name="email"]').blur(function() {
        var email = $(this).val();
        $.ajax({
            url: '{{url_for("api_user_exist_email")}}',
            type: 'POST',
            data: {
                email: email
            },
            dataType: 'json',
            error: function() {},
            success: function(data) {
                if (data['exist']) {
                    $('#register #register_error').css('opacity', '1').text('邮箱已注册');
                    $('#register button[type="submit"]').addClass('disabled');
                } else {
                    ok2 = true;
                }
                if (ok1 && ok2 && ok3) {
                    $('#register #register_error').css('opacity', '0');
                    $('#register button[type="submit"]').removeClass('disabled');
                }
            }
        });
    });

    $('#register input[name="password"]').blur(function() {
        var pwd = $(this).val();
        var pwd1 = $('#register input[name="password1"]').val();
        if (pwd == pwd1) {
            ok3 = true;
        } else {
            console.log('error3');
            $('#register #register_error').css('opacity', '1').text('两次密码不一致');
            $('#register button[type="submit"]').addClass('disabled');
        }
        if (ok1 && ok2 && ok3) {
            $('#register #register_error').css('opacity', '0');
            $('#register button[type="submit"]').removeClass('disabled');
        }
    });

    $('#register input[name="password1"]').keyup(function() {
        var pwd1 = $(this).val();
        var pwd = $('#register input[name="password"]').val();
        if (pwd == pwd1) {
            ok3 = true;
        } else {
            console.log('error3');
            $('#register #register_error').css('opacity', '1').text('两次密码不一致');
            $('#register button[type="submit"]').addClass('disabled');
        }
        if (ok1 && ok2 && ok3) {
            $('#register #register_error').css('opacity', '0');
            $('#register button[type="submit"]').removeClass('disabled');
        }
    });
});
</script>
{% endblock %}